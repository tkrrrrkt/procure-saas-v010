---
description: データモデル設計における履歴管理、監査ログ、インデックス最適化、テナント分離、暗号化、ソフトデリートに関するガイドライン。
globs: ["apps/procure-erp-backend/prisma/**/*.prisma", "packages/shared-types/**/*.ts"] # Prismaスキーマや共有型定義ファイルに適用 [cite: 5]
type: AutoAttached # 該当ファイルが参照された場合に適用 [cite: 65]
priority: 4
tags: ["data-model", "database", "security"]
version: "1.0.0"
---
# データモデル規約

## 4. データモデル
- **優れている点**: 履歴管理（DepartmentVersionなど）、監査ログモデル、インデックス最適化、エンティティ間の関連付け。これらは維持・発展させること。 [cite: 9]
- **改善ポイントへの対応**: [cite: 9]
    - **ソフトデリート**: データ削除は物理削除ではなくソフトデリート（`isDeleted` や `deletedAt` フィールドの使用）を原則とし、システム全体で一貫したソフトデリート戦略を適用すること。既存モデルで `valid_flg` が使用されている場合は、一貫した命名規則や実装パターンに沿って修正または統一すること。 [cite: 9]
    - **テナント分離**: テナントIDによるデータ分離を基本としつつ、より強固な分離（例: PostgreSQLのスキーマ分離）の検討を継続し、システムの成長に合わせて最適な戦略を選択できるように準備すること。 [cite: 10]
    - **暗号化**: メールアドレス、電話番号、取引先情報など、機密性の高いデータについては、データベース保存時および通信時に適切な暗号化戦略を明示的に設計・実装すること（例: カラムレベル暗号化、Vault連携）。 [cite: 10]